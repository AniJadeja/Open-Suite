events {
    worker_connections 1024;
}


http {
    # 1) Define a custom log format that shows:
    #    - request_uri   : the client’s original URI (before any rewrite)
    #    - uri            : the internal URI after rewrite
    #    - upstream_addr : the backend address Nginx actually connected to
    log_format proxy_mapping  '$remote_addr [$time_local] '
                              '"$request" '
                              'status=$status bytes=$body_bytes_sent '
                              'orig="$request_uri" '
                              'rewritten="$uri" '
                              'upstream="$upstream_addr" '
                              'upstream_status="$upstream_status" '
                              'resp_time=$request_time';

    # (Optional) You can keep your default log for everything else…
    access_log /var/log/nginx/access.log  proxy_mapping;


    # …or, define a separate file just for these proxy mappings:
    # access_log /var/log/nginx/proxy_mapping.log proxy_mapping;

    server {
        listen 80;
        server_name hopp-ui.localhost;

        # UI/Admin
        location / {
            proxy_pass http://hoppscotch:81;
            # standard proxy headers…
            proxy_set_header Host              $host;
            proxy_set_header X-Real-IP         $remote_addr;
            proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

       

        # …any other locations…
    }


    server {
        listen 80;
        server_name hopp-api.localhost;

        location = /api/graphql {
            proxy_pass         http://hoppscotch:8080/graphql;
            proxy_http_version 1.1;
            proxy_set_header   Host              $host;
            proxy_set_header   X-Real-IP         $remote_addr;
            proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;
            proxy_set_header   X-Forwarded-Proto $scheme;
            proxy_set_header   Upgrade           $http_upgrade;
        }


        # API → v1 backend
        location  ^/api/(.*)$ {
            proxy_pass http://hoppscotch:8080/v1/$1;
            proxy_http_version 1.1;
            proxy_set_header   Host              $host;
            proxy_set_header   X-Real-IP         $remote_addr;
            proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;
            proxy_set_header   X-Forwarded-Proto $scheme;
            proxy_set_header   Upgrade           $http_upgrade;
        }
    }
}
